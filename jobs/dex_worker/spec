---
name: dex_worker

packages:
  - dex

templates:
  bin/dex_worker_ctl: bin/dex_worker_ctl
  bin/post-start: bin/post-start
  config/clients.json: config/clients.json
  config/connectors.json: config/connectors.json
  config/emailer.json: config/emailer.json
  config/tls_cert.pem: config/tls_cert.pem
  config/tls_key.pem: config/tls_key.pem
  config/users.json: config/users.json

provides:
  - name: dex
    type: dex_worker
    properties:
      - dex.worker.db_url
      - dex.worker.key_secrets
      - dex.worker.port

properties:
  dex.worker.api_use_client_credentials:
    description: "Forces API to authenticate using client credentials instead of ID token. Clients must be 'admin clients' to use the API"
    default: false
  dex.worker.clients:
    description: "Clients configuration"
    default: |
      []
  dex.worker.connectors:
    description: "Connectors configuration"
    default: |
      [
        {
          "type": "local",
          "id": "local"
        }
      ]
  dex.worker.db_max_idle_conns:
    description: "maximum number of connections in the idle connection pool"
  dex.worker.db_max_open_conns:
    description: "maximum number of open connections to the database"
  dex.worker.db_url:
    description: "DSN-formatted database connection string"
  dex.worker.emailer:
    description: "Email configuration"
    default: |
      {
          "type": "fake",
          "from": "noreply@example.com"
      }
  dex.worker.enable_automatic_registration:
    description: "When a user logs in through a federated identity service, automatically register them if they don't have an account"
    default: false
  dex.worker.enable_client_registration:
    description: "Allow dynamic registration of clients"
    default: false
  dex.worker.enable_registration:
    description: "Allows users to self-register"
    default: false
  dex.worker.issuer_host:
    description: "the issuer's host"
  dex.worker.issuer_logo_url:
    description: "URL of an image representing the issuer"
  dex.worker.issuer_name:
    description: "The name of this dex installation; will appear on most pages"
  dex.worker.key_secrets:
    description: "A comma-separated list of base64 encoded 32 byte strings used as symmetric keys used to encrypt/decrypt signing key data in DB. The first key is considered the active key and used for encryption, while the others are used to decrypt"
  dex.worker.no_db:
    description: "manage entities in-process w/o any encryption, used only for single-node testing"
    default: false
  dex.worker.port:
    description: "the port that the server will listen on"
    default: 5556
  dex.worker.log_debug:
    description: "log debug-level information"
    default: false
  dex.worker.log_timestamps:
    description: "prefix log lines with timestamps"
    default: true
  dex.worker.tls_cert:
    description: "the server's certificate for TLS connection"
  dex.worker.tls_key:
    description: "the server's private key for TLS connection"
  dex.worker.users:
    description: "Users configuration"
    default: |
      []
